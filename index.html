
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Ganesh Dai Academy - Grade 11 & 12 Study Hub</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- React & ReactDOM -->
    <script src="https://unpkg.com/react@18.2.0/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18.2.0/umd/react-dom.production.min.js"></script>
    <!-- Babel -->
    <script src="https://unpkg.com/@babel/standalone@7.24.7/babel.min.js"></script>
    <!-- Font Awesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css" rel="stylesheet" />
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700;800&family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
    <!-- html2canvas for downloads -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        body { font-family: 'Inter', system-ui, sans-serif; background-color: #f1f5f9; }
        .dark body { background-color: #020617; }
        h1, h2, h3, h4, h5, h6, .font-display { font-family: 'Poppins', sans-serif; }
        
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .animate-fadeIn { animation: fadeIn 0.5s ease-out forwards; }
        @keyframes popIn { from { transform: scale(0.95); opacity: 0; } to { transform: scale(1); opacity: 1; } }
        .animate-popIn { animation: popIn 0.4s ease-out forwards; }
        
        .gradient-button { background-image: linear-gradient(45deg, #14b8a6, #0891b2); color: white; transition: all .3s ease; }
        .gradient-button:hover:not(:disabled) { transform: translateY(-2px); box-shadow: 0 8px 20px rgba(13, 148, 136, .3); }
        
        .nav-link { transition: all .2s ease-in-out; }
        .nav-link.active { color: #14b8a6; background-color: #ccfbf1; font-weight: 600; }
        .dark .nav-link.active { color: #5eead4; background-color: #1e293b; }
        .nav-link:not(.active):hover { background-color: #f1f5f9; }
        .dark .nav-link:not(.active):hover { background-color: #1e293b; }

        .overlay { position: fixed; inset: 0; background-color: rgba(0,0,0,.7); display: flex; justify-content: center; align-items: center; z-index: 1000; padding: 1rem; backdrop-filter: blur(4px); animation: fadeIn 0.3s ease; }
        .modal-box { padding: 0; border-radius: 1rem; box-shadow: 0 20px 40px rgba(0,0,0,.3); text-align: center; color: #111827; animation: popIn .4s ease-out; max-width: 95%; width: 500px; overflow: hidden; }
        .dark .modal-box { color: #f3f4f6; }
        
        .pdf-viewer-modal { background: #0f172a; padding: 0; border-radius: .75rem; overflow: hidden; width: 98vw; height: 95vh; max-width: 1600px; display: flex; flex-direction: column; position: relative; }
        .pdf-viewer-modal .header { padding: .75rem 1.5rem; background: #020617; display:flex; justify-content: space-between; align-items: center; border-bottom: 1px solid #334155; flex-shrink: 0; }
        .pdf-viewer-modal iframe { flex-grow: 1; border: none; background-color: #334155; pointer-events: auto; }
        .iframe-overlay { position: absolute; top: 0; left: 0; right: 0; bottom: 0; } /* Used for protection */
    </style>
</head>
<body class="bg-slate-100 dark:bg-slate-950 text-slate-800 dark:text-slate-200">
    <div id="root"></div>

<script type="text/babel">
    const { useState, useEffect, useMemo, useCallback, Fragment, Component } = React;

    // =================================================================================
    // ===== CONFIGURATION & DATA =====
    // =================================================================================
    const DATA = {
        appName: "Ganesh Dai Academy",
        appSubtitle: "Grade 11 & 12 Study Hub",
        logoUrl: "https://raw.githubusercontent.com/MissionBalenScholarshipQuiz/12/55fa0b325c116947dc1736ebb3c6fcf45b997777/2a4a2158-0beb-445d-81d0-ccfc3e8ad099.jpg",
        socials: {
            youtube: "https://www.youtube.com/@Grade11-12StudyHub",
            facebook: "https://www.facebook.com/ganesh.dahal.627352/",
        },
        esewaId: "9863997295",
        whatsAppContactLink: "https://wa.me/9826594548?text=" + encodeURIComponent("I have paid for Ganesh Dai Academy premium. Please provide my activation code."),
        presentationRequestNumber: "9826594548",
        streams: [
            { id: 'science', name: 'Science', compulsory: ['English', 'Nepali', 'Physics', 'Chemistry', 'Mathematics'], optional: [['Biology', 'Computer Science']], optional_count: 1 },
            { id: 'management', name: 'Management', compulsory: ['English', 'Nepali', 'Accountancy', 'Economics'], optional: [['Business Studies', 'Business Mathematics', 'Computer Science', 'Social']], optional_count: 2 }
        ],
        digitalLibrary: [
    {
      id: 2001,
      title: 'NEB Grade 11 — All Subject Notes (All-in-one)',
      link: 'https://drive.google.com/file/d/1Twsmqo8m0HILemG2jub78Vk_DngB40bn/view?usp=drive_link',
      description: 'Complete PDF notes for Grade 11 — all subjects.',
      isPremium: true
    },
    {
      id: 2002,
      title: 'Physics – NEB Solutions & Model Papers',
      link: 'https://drive.google.com/file/d/1LPE32JyGu0n20MJheD1lq0o-6qLtokjK/view?usp=drive_link',
      description: 'Past-year solutions and model question sets.',
      isPremium: false
    },
  ],
        subjectData: {
            'English': { credits: 4 }, 'Nepali': { credits: 3 }, 'Mathematics': { credits: 5 }, 'Physics': { credits: 5 }, 'Chemistry': { credits: 5 }, 'Biology': { credits: 5 }, 'Computer Science': { credits: 5 }, 'Accountancy': { credits: 5 }, 'Economics': { credits: 5 }, 'Business Studies': { credits: 5 }, 'Business Mathematics': { credits: 5 }, 'Social': { credits: 5 },
        },
        gradePoints: { 'A+': 4.0, 'A': 3.6, 'B+': 3.2, 'B': 2.8, 'C+': 2.4, 'C': 2.0, 'D': 1.6, 'NG': 0.0 },
        notes: [
        //ALLINONE Grade 11 
  { id: 91, grade: 11, subject: 'Chemistry', title: 'All Past Year Model Question Saint Xavier', link: 'https://drive.google.com/file/d/10m-T2hfjyQ-7AWTlDeTY-TrS9cYlL8DQ/view?usp=drive_link', isPremium: false },
  { id: 92, grade: 11, subject: 'Chemistry', title: 'OLD is GOLD Question Bank (All Subject)', link: 'https://drive.google.com/file/d/1H92WYzcYca456OIgi-xx78sdwAv35tsJ/view?usp=drive_link', isPremium: true },
 { id: 92, grade: 11, subject: 'Physics', title: 'NEB Solution of physic', link: 'https://drive.google.com/file/d/1LPE32JyGu0n20MJheD1lq0o-6qLtokjK/view?usp=drive_link', isPremium: true },
  
  // Physics grade 11 ...............
               { id: 1, grade: 11, subject: 'Physics', title: 'Chapter 1: Unit and Dimension', link: 'https://drive.google.com/file/d/178ortL2-MP8zK9pOaSX-0KTKFUz5OhUI/view?usp=sharing', isPremium: false },
    { id: 2, grade: 11, subject: 'Physics', title: 'Chapter 2: Vectors', link: 'https://drive.google.com/file/d/19q88Gi6sk4TXrwkP-Pmql4KDDX0sPd3u/view', isPremium: false },
    { id: 3, grade: 11, subject: 'Physics', title: 'Chapter 3: Kinematics', link: 'https://drive.google.com/file/d/1A3z-ZPzLIOdy7e6eC5TX35KGyfvOqzZh/view', isPremium: false },
    { id: 4, grade: 11, subject: 'Physics', title: 'Chapter 4: Dynamics', link: 'https://drive.google.com/file/d/1A3z-ZPzLIOdy7e6eC5TX35KGyfvOqzZh/view', isPremium: false },
     { id: 40000, grade: 11, subject: 'Physics', title: 'Chapter 4: Dynamics Notes 2', link: 'https://drive.google.com/file/d/1_2Qy9xum2kwST-E6Khs6jA3270Q9v1-L/view?usp=drive_link', isPremium: false },        
    { id: 5, grade: 11, subject: 'Physics', title: 'Chapter 5: Work, Energy and Power', link: 'https://drive.google.com/file/d/1JqUcWrMuhBFuCFaGso5Sd6uxt_D1iSvP/view?usp=sharing', isPremium: false },
    { id: 6, grade: 11, subject: 'Physics', title: 'Chapter 6: Circular Motion', link: 'https://drive.google.com/file/d/1-pvhSMupNVW0QJGcVykufJFVqXfk5jRE/view?usp=drive_link', isPremium: false },
    { id: 7, grade: 11, subject: 'Physics', title: 'Chapter 7: Gravitation', link: 'https://drive.google.com/file/d/1Iw7U6r1tGnmPH6QLnkiOgDl9vGS55zCv/view?usp=drive_link', isPremium: false },
    // { id: 8, grade: 11, subject: 'Physics', title: 'Chapter 8: Elasticity', link: '#', isPremium: false },
    // { id: 9, grade: 11, subject: 'Physics', title: 'Chapter 9: Heat and Temperature', link: '#', isPremium: false },
   // { id: 10, grade: 11, subject: 'Physics', title: 'Chapter 10: Thermal Expansion', link: '#', isPremium: false },
    // { id: 11, grade: 11, subject: 'Physics', title: 'Chapter 11: Quantity of Heat', link: '#', isPremium: false },
     // { id: 12, grade: 11, subject: 'Physics', title: 'Chapter 12: Rate of Heat Flow', link: '#', isPremium: false },
   { id: 13, grade: 11, subject: 'Physics', title: 'Chapter 13: Ideal Gas', link: 'https://drive.google.com/file/d/18Lw1yowtIzcuDfeeVr2wa6Wor7U71PCk/view?usp=drive_link', isPremium: false },
   //   { id: 14, grade: 11, subject: 'Physics', title: 'Chapter 14: Reflection at Curved Mirror', link: '#', isPremium: false },
     { id: 15, grade: 11, subject: 'Physics', title: 'Chapter 15: Refraction at Plane Surface', link: 'https://drive.google.com/file/d/1UXPH9X2H-kJNyVG0CRgZT0O_iV4U-JMu/view?usp=drive_link', isPremium: false },
    //  { id: 16, grade: 11, subject: 'Physics', title: 'Chapter 16: Refraction Through Prism', link: '#', isPremium: false },
   //   { id: 17, grade: 11, subject: 'Physics', title: 'Chapter 17: Lenses', link: '#', isPremium: false },
   //   { id: 18, grade: 11, subject: 'Physics', title: 'Chapter 18: Dispersion', link: '#', isPremium: false },
   //   { id: 19, grade: 11, subject: 'Physics', title: 'Chapter 19: Electric Charge', link: '#', isPremium: false },
    { id: 20, grade: 11, subject: 'Physics', title: 'Chapter 20: Electric Field', link: 'https://drive.google.com/file/d/1qVXMBMc4DHuFEkNAmgsSZ9gY-6_q6Zj_/view?usp=drive_link', isPremium: false },
   //   { id: 21, grade: 11, subject: 'Physics', title: 'Chapter 21: Electric Potential and Energy', link: '#', isPremium: false },
    { id: 22, grade: 11, subject: 'Physics', title: 'Chapter 22: Capacitor and Capacitance', link: 'https://drive.google.com/file/d/1GjUkgrsmyRv3RJbvHUqmXiRIkHceIDa7/view?usp=drive_link', isPremium: false },
   //   { id: 23, grade: 11, subject: 'Physics', title: 'Chapter 23: DC Circuit', link: '#', isPremium: false },
     { id: 24, grade: 11, subject: 'Physics', title: 'Chapter 24: Nuclear Physics', link: 'https://drive.google.com/file/d/1vGHhytFU97B9XpIn2aWaerZqWzfhWKdg/view?usp=drive_link', isPremium: false },
     { id: 25, grade: 11, subject: 'Physics', title: 'Chapter 25: Solid', link: 'https://drive.google.com/file/d/1tnyzm4N_YsVUd6uW1--oaHZMsNP12ITb/view?usp=drive_link', isPremium: false },
   //   { id: 26, grade: 11, subject: 'Physics', title: 'Chapter 26: Recent Trends in Physics', link: '#', isPremium: false },

              // Mathematics grade 11 ...............
               { id: 1001, grade: 11, subject: 'Mathematics', title: 'All Required Formula', link: 'https://drive.google.com/file/d/1LmRl2CNWPIUAfoyR1hch84UkHhG5r3NT/view', isPremium: false },
             { id: 1002, grade: 11, subject: 'Mathematics', title: 'Application of Derivatives', link: 'https://drive.google.com/file/d/1pQtaBDd0RBLf1Et4d_S6KIHPkOwVtPwA/view', isPremium: false },
             { id: 1003, grade: 11, subject: 'Mathematics', title: 'Antiderivatives', link: 'https://drive.google.com/file/d/1q-NpT-ueLZvjHZHjlGLRL1A3X_MHYXrV/view', isPremium: false },
    
     //Biology grade 11 ...............
               { id: 2001, grade: 11, subject: 'Biology', title: 'Cell Biology', link: 'https://drive.google.com/file/d/14Ohb60T-q3sI5XXbXTiz43hY-UxWb80n/view', isPremium: false },
            // Chemistry .....................

    { id: 27, grade: 11, subject: 'Chemistry', title: 'Chapter 1: Foundation and Fundamentals', link: 'https://drive.google.com/file/d/1AuHGWyxBDjBtH4rGMH7JaBaVvgREOKJR/view?usp=sharing', isPremium: false },
    { id: 28, grade: 11, subject: 'Chemistry', title: 'Chapter 2: Stoichiometry', link: 'https://drive.google.com/file/d/1AnNzZ_KejeWSbBTATk9gNc_6zz0uwByP/view?usp=sharing', isPremium: false },
    { id: 29, grade: 11, subject: 'Chemistry', title: 'Redox Reaction', link: 'https://drive.google.com/file/d/1LaSQwV4abLBa0PewrikGWCp5geRm9vwF/view?usp=drive_link', isPremium: false },
    //  { id: 30, grade: 11, subject: 'Chemistry', title: 'Chapter 4: Periodic Table', link: '#', isPremium: false },
    { id: 31, grade: 11, subject: 'Chemistry', title: 'Chapter 5: Chemical Bonding and Shape of Molecules', link: '#', isPremium: false },
   //   { id: 32, grade: 11, subject: 'Chemistry', title: 'Chapter 6: Oxidation and Reduction', link: '#', isPremium: false },
  //    { id: 33, grade: 11, subject: 'Chemistry', title: 'Chapter 7: State of Matter', link: '#', isPremium: false },
  //    { id: 34, grade: 11, subject: 'Chemistry', title: 'Chapter 8: Chemical Equilibrium', link: '#', isPremium: false },
  //    { id: 35, grade: 11, subject: 'Chemistry', title: 'Chapter 9: Chemistry of Non Metals (Hydrogen) , link: '#', isPremium: false },
  //    { id: 36, grade: 11, subject: 'Chemistry', title: 'Chapter 10: Chemistry of Metals', link: '#', isPremium: false },
  //    { id: 37, grade: 11, subject: 'Chemistry', title: 'Chapter 11: Bio-Inorganic Chemistry', link: '#', isPremium: false },
   //   { id: 38, grade: 11, subject: 'Chemistry', title: 'Chapter 12: Basic Concept of Organic Chemistry', link: '#', isPremium: false },
  { id: 39, grade: 11, subject: 'Chemistry', title: 'Hydrocarbon', link: 'https://drive.google.com/file/d/1isy9p4pW1RGnakYSTV7m7eTV1lW6pqAR/view?usp=drive_link', isPremium: false },
   { id: 40, grade: 11, subject: 'Chemistry', title: 'Chapter 14: Hydrocarbons', link: 'https://drive.google.com/file/d/1isy9p4pW1RGnakYSTV7m7eTV1lW6pqAR/view?usp=drive_link', isPremium: false },
   //   { id: 41, grade: 11, subject: 'Chemistry', title: 'Chapter 15: Aromatic Chemistry', link: '#', isPremium: false },
   //   { id: 42, grade: 11, subject: 'Chemistry', title: 'Chapter 16: Fundamentals of Applied Chemistry', link: '#', isPremium: false },
     { id: 43, grade: 11, subject: 'Chemistry', title: 'Mole Concept', link: 'https://drive.google.com/file/d/1jxCaNO8ztUR_tXseI_SUvJPzRK4enfOu/view?usp=drive_link', isPremium: false },

            
 { id: 56, grade: 11, subject: 'Nepali', title: 'Chapter 1: वीर पुर्खा (कविता)', link: 'https://drive.google.com/file/d/14o1jiIKU6CxSQw7pAu_ofmASW9j3ET62/view?usp=sharing', isPremium: false },
{ id: 57, grade: 11, subject: 'Nepali', title: 'Chapter 2: गाउँको माया (सामाजिक कथा)', link: 'https://drive.google.com/file/d/1QXJGVAPRw_Sn3x7XTcXZSz-F2gJwm_GH/view?usp=drive_link', isPremium: false },
{ id: 58, grade: 11, subject: 'Nepali', title: 'Chapter 3: संस्कृतिको नयाँ यात्रा (आत्मपरक निबन्ध)', link: 'https://drive.google.com/file/d/1xtfOah6kXFZJZ1kttcYJB0EPIc_pmJre/view?usp=drive_link', isPremium: false },
{ id: 59, grade: 11, subject: 'Nepali', title: 'Chapter 4: योगमाया (राष्ट्रिय जीवनी)', link: 'https://drive.google.com/file/d/1xtfOah6kXFZJZ1kttcYJB0EPIc_pmJre/view?usp=drive_link', isPremium: false },
{ id: 60, grade: 11, subject: 'Nepali', title: 'Chapter 5: साथीलाई चिठी (चिठी)', link: 'https://drive.google.com/file/d/1c58gPPDRi3oXIBv4Q78w3sZ0MnijrR4M/view?usp=drive_link', isPremium: false },
{ id: 61, grade: 11, subject: 'Nepali', title: 'Chapter 6: त्यो फेरि फर्कला ? (मनोवैज्ञानिक कथा)', link: 'https://drive.google.com/file/d/1DTuckBk17asB7jyt7nxDPupM-ArIdTQN/view?usp=drive_link', isPremium: false },
{ id: 62, grade: 11, subject: 'Nepali', title: 'Chapter 7: पर्यापर्यटनका सम्भावना र आयाम (वस्तुपरक निबन्ध)', link: 'https://drive.google.com/file/d/1KmSgmBGFuplBHWL7t-g8pNavDszk1CJX/view?usp=drive_link', isPremium: false },
{ id: 63, grade: 11, subject: 'Nepali', title: 'Chapter 8: लौ आयो ताजा खबर (लघु नाटक)', link: 'https://drive.google.com/file/d/1ZCEuV5Uk8JcvkEQ_BpWpkCiUQwKydPkF/view?usp=drive_link', isPremium: false },
{ id: 64, grade: 11, subject: 'Nepali', title: 'Chapter 9: सफलताको कथा (रिपोर्ताजमूलक रचना)', link: 'https://drive.google.com/file/d/1dZtM1SIUXF84hC0FMHyn-N1pNRgLHLNk/view?usp=drive_link', isPremium: false },
{ id: 65, grade: 11, subject: 'Nepali', title: 'Chapter 10: कृषिशालामा एक दिन (संवाद)', link: 'https://drive.google.com/file/d/1KIAkEeir7EvLs_5m3gmGbWv3bycrWQyL/view?usp=drive_link', isPremium: false },
{ id: 66, grade: 11, subject: 'Nepali', title: 'Chapter 11: रारा भ्रमण (दैनिकी)', link: 'https://drive.google.com/file/d/1QJONcOzYBEJ1zcvWXk-wdjlDvjcol1yv/view?usp=drive_link', isPremium: false },
{ id: 67, grade: 11, subject: 'Nepali', title: 'Chapter 12: जलस्रोत र ऊर्जा (वक्तृता)', link: 'https://drive.google.com/file/d/1QJONcOzYBEJ1zcvWXk-wdjlDvjcol1yv/view?usp=drive_link', isPremium: false },

//grade 11 English 
{ id: 68, grade: 11, subject: 'English', title: 'Short Story 1: The Selfish Giant', link: 'https://drive.google.com/file/d/1WZLcd_cF2OQOkb94ROJo248IeTzksJlz/view?usp=drive_link', isPremium: false },
{ id: 69, grade: 11, subject: 'English', title: 'Short Story 2: The Oval Portrait', link: 'https://drive.google.com/file/d/1GFra9h7f99v5PQowLbc1C9SrJQ4vr9NX/view?usp=drive_link', isPremium: false },
{ id: 70, grade: 11, subject: 'English', title: 'Short Story 3: God Sees the Truth but Waits', link: 'https://drive.google.com/file/d/1or-fUzIpVib4TKV4obxtWTmF4Sq_uoAT/view?usp=drive_link', isPremium: false },
{ id: 71, grade: 11, subject: 'English', title: 'Short Story 4: The Wish', link: 'https://drive.google.com/file/d/1GvVpSpxu-gBYO3vcTeyqUUq-rDNdvN4Q/view?usp=drive_link', isPremium: false },
{ id: 72, grade: 11, subject: 'English', title: 'Short Story 5: Civil Peace', link: 'https://drive.google.com/file/d/1oVWYQHjqOjuU-pNXHw7qwwS6QM6UHcSi/view?usp=drive_link', isPremium: false },
{ id: 73, grade: 11, subject: 'English', title: 'Short Story 6: Two Little Soldiers', link: 'https://drive.google.com/file/d/11dncnQtHkiIkijcT8mV1YRJyqiSFqYZX/view?usp=drive_link', isPremium: false },
{ id: 74, grade: 11, subject: 'English', title: 'Short Story 7: An Astrologer’s Day', link: 'https://drive.google.com/file/d/1tPbLQW_0oE6q1JixGbPZr6q4g6QOVnJz/view?usp=drive_link', isPremium: false },
{ id: 75, grade: 11, subject: 'English', title: 'Poem 1: Corona Says', link: 'https://drive.google.com/file/d/1S9A49FBnAw3ISzjO3TZnC_JlutqXJtPV/view?usp=drive_link', isPremium: false },
{ id: 76, grade: 11, subject: 'English', title: 'Poem 2: A Red, Red Rose', link: 'https://drive.google.com/file/d/1YjeVe1YWNFb8kg_FciGowWlU1zRldn-C/view?usp=drive_link', isPremium: false },
{ id: 77, grade: 11, subject: 'English', title: 'Poem 3: All the World’s a Stage', link: 'https://drive.google.com/file/d/1YjeVe1YWNFb8kg_FciGowWlU1zRldn-C/view?usp=drive_link', isPremium: false },
{ id: 78, grade: 11, subject: 'English', title: 'Poem 4: Who are you, little i?', link: 'https://drive.google.com/file/d/1ERog4fo4dXscQYbV2WRcsnRiFn2ZEVZl/view?usp=drive_link', isPremium: false },
{ id: 79, grade: 11, subject: 'English', title: 'Poem 5: The Gift in Wartime', link: 'https://drive.google.com/file/d/1PLbzZlJajMQZnfOpLNtG2MZVaYrfEST1/view?usp=drive_link', isPremium: false },
{ id: 80, grade: 11, subject: 'English', title: 'Essay 1: Sharing Tradition', link: 'https://drive.google.com/file/d/16C1MWTlPpwa9RooXQ7iegUr83bBAqHLr/view?usp=drive_link', isPremium: false },
{ id: 81, grade: 11, subject: 'English', title: 'Essay 2: How to Live Before You Die', link: 'Summary and Exercise', isPremium: false },
{ id: 82, grade: 11, subject: 'English', title: 'Essay 3: What I Require from Life', link: 'Summary and Exercise', isPremium: false },
{ id: 83, grade: 11, subject: 'English', title: 'Essay 4: What is Poverty?', link: 'https://drive.google.com/file/d/1WCiA50pxL4-U2L34oiy58CFhzH4lxu0L/view?usp=drive_link', isPremium: false },
{ id: 84, grade: 11, subject: 'English', title: 'Essay 5: Scientific Research is a Token of Humankind’s Survival', link: 'https://drive.google.com/file/d/1jSLzmB8_Ga8xHOBpZAP8naPur_5Tjjfv/view?usp=drive_link', isPremium: false },
{ id: 85, grade: 11, subject: 'English', title: 'One Act Play 1: Trifles', link: 'https://drive.google.com/file/d/1xO0jjNFWFM8aG1PQzoAsTWoYt1nXXOO9/view?usp=drive_link', isPremium: false },
{ id: 86, grade: 11, subject: 'English', title: 'One Act Play 2: A Sunny Morning', link: 'https://drive.google.com/file/d/1PPCE_ZlmcRfpGwlSenpR9PYFHYdnVjOL/view?usp=drive_link', isPremium: false },
{ id: 87, grade: 11, subject: 'English', title: 'One Act Play 3: Refund', link: 'https://drive.google.com/file/d/1MNPZk9zEaQKkPPexdBdf5TL9jmJ9O91D/view?usp=drive_link', isPremium: false },

//ALLINONE Grade 12 
 { id: 67, grade: 12, subject: 'English', title: 'All chapter Notes', link: 'https://drive.google.com/file/d/1BqvnQbwHArrfTJyayfvMpO6K4w_qHYxu/view?usp=sharing', isPremium: false },
  { id: 56, grade: 12, subject: 'Nepali', title: 'All chapter Notes', link: 'https://drive.google.com/file/d/1tXMGn94Kc3-DOhNaoXJgMqzXL9uuFiwq/view?usp=drive_link', isPremium: false },
  { id: 90, grade: 12, subject: 'Physic', title: 'NEB Solution of Physic', link: 'https://drive.google.com/file/d/1LPE32JyGu0n20MJheD1lq0o-6qLtokjK/view?usp=drive_link', isPremium: false },
  { id: 91, grade: 12, subject: 'Chemistry', title: 'NEB Solution of CHEMISTRY ', link: 'https://drive.google.com/file/d/1Xc9EBCoFfBQCe7cEWTvboOCXe1sEaRWO/view?usp=drive_link', isPremium: false },
  { id: 92, grade: 12, subject: 'Chemistry', title: 'Chemistry (Old Course) Model Question', link: 'https://drive.google.com/file/d/1jtYvAHccbyaQJvSrArK8GkR7td4pQG_F/view?usp=drive_link', isPremium: false },
  { id: 93, grade: 12, subject: 'Chemistry', title: 'Chemistry (New Course) Model Question', link: 'https://drive.google.com/file/d/1LbdV2IJ3_l5bS7x7Y4adO-NQdLxxiAjL/view?usp=drive_link', isPremium: false },
 
 // GRADE 12 NEPALI .............................................................................
   { id: 44, grade: 12, subject: 'Nepali', title: 'Chapter 1: आमाको सपना', link: 'https://drive.google.com/file/d/17k0Pn06jyisTNs9NWg3uI2yUtlc2A2Ns/view?usp=drive_link', isPremium: false },
    { id: 45, grade: 12, subject: 'Nepali', title: 'Chapter 2: विरहिणी दमयन्ती', link: 'https://drive.google.com/file/d/1Cd8K4t86nSyYL1xgvyQgU1Vfm_P59pj-/view?usp=drive_link', isPremium: false },
    { id: 46, grade: 12, subject: 'Nepali', title: 'Chapter 3: घनघस्याको उकालो काट्ता', link: '#', isPremium: false },
    { id: 47, grade: 12, subject: 'Nepali', title: 'Chapter 4: व्यावसायिक पत्र', link: '#', isPremium: false },
    { id: 48, grade: 12, subject: 'Nepali', title: 'Chapter 5: एक चिहान', link: '#', isPremium: false },
    { id: 49, grade: 12, subject: 'Nepali', title: 'Chapter 6: स्टिफन विलियम हकिङ', link: '#', isPremium: false },
    { id: 50, grade: 12, subject: 'Nepali', title: 'Chapter 7: हामीलाई बोलाउँछन् हिमचुली', link: '#', isPremium: false },
    { id: 51, grade: 12, subject: 'Nepali', title: 'Chapter 8: मातृत्व', link: '#', isPremium: false },
    { id: 52, grade: 12, subject: 'Nepali', title: 'Chapter 9: गोर्खे', link: '#', isPremium: false },
    { id: 53, grade: 12, subject: 'Nepali', title: 'Chapter 10: नेपाली पहिचान', link: '#', isPremium: false },
    { id: 54, grade: 12, subject: 'Nepali', title: 'Chapter 11: सहकारी', link: '#', isPremium: false },
    { id: 55, grade: 12, subject: 'Nepali', title: 'Chapter 12: जीवन मार्ग', link: '#', isPremium: false },
    
    // computer ..................
     { id: 88, grade: 12, subject: 'Computer Science', title: 'Chapter 1: Database Management System-DBMS', link: 'https://drive.google.com/file/d/1DtSP6LLwHNyjoocexF27JqufbCCWk5xW/view?usp=drive_link', isPremium: false },
    { id: 89, grade: 12, subject: 'Computer Science', title: 'Chapter 2: C Programming', link: 'https://drive.google.com/file/d/17jaxvRuaGkUPgxaoj09z53EpA7sTbe6X/view?usp=drive_link', isPremium: false },
    { id: 97, grade: 12, subject: 'Computer Science', title: 'Chapter 3: Web Technology', link: 'https://drive.google.com/file/d/1eBIC14NIjS0OrQ2noOr-bazkf8I6AUqg/view?usp=drive_link', isPremium: false },
    { id: 98, grade: 12, subject: 'Computer Science', title: 'Chapter 6: Software Process Model-SPM', link: 'https://drive.google.com/file/d/11HjWSVEM6dBpaRgaz8pHjs7e1DdrUzN7/view?usp=drive_link', isPremium: false },
    { id: 99, grade: 12, subject: 'Computer Science', title: 'Chapter 4: Data-Communication and Networking', link: 'https://drive.google.com/file/d/12BHeC0oavhFZSBMdG4uFpmq4xIDLqhfO/view?usp=drive_link', isPremium: false },
    { id: 100, grade: 12, subject: 'Computer Science', title: 'Model Questions Papers', link: 'https://drive.google.com/file/d/1I9AsK1N4rpr5Knn77kOYvZXCWJuGzNze/view?usp=drive_link', isPremium: false },
     { id: 101, grade: 12, subject: 'Computer Science', title: 'Important Questions', link: 'https://drive.google.com/file/d/1qgWiKrtiOWFBUsayWyaKrd7UbMJyBFwK/view?usp=drive_link', isPremium: false },
      { id: 102, grade: 12, subject: 'Computer Science', title: 'Extra C Programming Solution', link: 'https://drive.google.com/file/d/1JWEsgCwlMlJSZnjpqcVRfkdq4ormqiGD/view?usp=drive_link', isPremium: false },

            // Economics
     { id: 103, grade: 11, subject: 'Economics', title: 'Basic Concept of Economics and Allocation of Resource', link: 'https://drive.google.com/file/d/1NSkP2fRnDRajGjekFAhYQpb1yujkUg8Y/view', isPremium: false },
      { id: 104, grade: 11, subject: 'Economics', title: 'Demand, Supply and Market Equilibrium', link: 'https://drive.google.com/file/d/1HEF4vS2yj3I3G_zJ0nI2i8DIlJIc8F6f/view', isPremium: false },

              // Computer
     { id: 105, grade: 11, subject: 'Computer Science', title: 'Computer System', link: 'https://drive.google.com/file/d/10XsdgPqsIcxVk-OgkVdCgTjUwRXzad9T/view', isPremium: false },
      { id: 106, grade: 11, subject: 'Computer Science', title: 'Number System', link: 'https://drive.google.com/file/d/1NG6wBIswzHTNUs0M_o1KEETF42zzTJDO/view', isPremium: false },
    
        ],
        examPreps: {
            routines: [ { subject: "Compulsory English", date: "2081/01/14" }, { subject: "Physics / Accountancy", date: "2081/01/16" }, ],
            checklists: [ { subject: 'Physics', id: 'phy_checklist', items: ['Revise all derivations in Mechanics', 'Practice numericals from Wave & Optics', 'Memorize key formulas for Modern Physics'] }, { subject: 'Accountancy', id: 'acc_checklist', items: ['Practice Company Account final statements', 'Revise partnership admission and retirement', 'Solve one complete model set'] }, ],
            modelQuestions: [ { id: 1, title: 'NEB Grade 11 All Subject Model set 2082 Grade 11', link: 'https://drive.google.com/file/d/1Twsmqo8m0HILemG2jub78Vk_DngB40bn/view?usp=drive_link', isPremium: true }, { id: 2, title: 'OLD is GOLD Question Bank Grade 12', link: 'https://drive.google.com/file/d/1Xc9EBCoFfBQCe7cEWTvboOCXe1sEaRWO/view?usp=drive_link', isPremium: true },  { id: 3, grade: 11, subject: 'All subject', title: 'OLD is GOLD Question Bank Grade 11', link: 'https://drive.google.com/file/d/1H92WYzcYca456OIgi-xx78sdwAv35tsJ/view?usp=drive_link', isPremium: true }, ]
        },
        motivationalQuotes: ["The secret of getting ahead is getting started.", "Believe you can and you're halfway there.", "The expert in anything was once a beginner."],
        brainTeasers: [
            { question: "I speak without a mouth and hear without ears. I have no body, but I come alive with wind. What am I?", answer: "echo" },
            { question: "What has an eye, but cannot see?", answer: "needle" },
            { question: "What is full of holes but still holds water?", answer: "sponge" }
        ],
        digitalLibrary: [
  {
    id: 2001,
    title: 'NEB Grade 11 — All Subject Model Question (All-in-one)',
    link: 'https://drive.google.com/file/d/1Twsmqo8m0HILemG2jub78Vk_DngB40bn/view?usp=drive_link',
    description: 'Complete PDF notes for Grade 11 — all subjects.',
    isPremium: false
  },
  {
    id: 2002,
    title: 'Physics – NEB Solutions & Model Papers',
    link: 'https://drive.google.com/file/d/1LPE32JyGu0n20MJheD1lq0o-6qLtokjK/view?usp=drive_link',
    description: 'Past-year solutions and model question sets.',
    isPremium: false
  },
  {
    id: 2003,
    title: 'ALL PHYSIC FORMULA',
    link: 'https://drive.google.com/file/d/1ySI_fHc3LYs0sR9GoF8nWc9xykEz_6IK/view?usp=drive_link',
    description: 'All required formula for +2',
    isPremium: false
  },
   { id: 2004, 
   title: 'All Past Year Model Question Saint Xavier', 
   link: 'https://drive.google.com/file/d/10m-T2hfjyQ-7AWTlDeTY-TrS9cYlL8DQ/view?usp=drive_link', 
    description: 'All NEB chemistry model question papers in one PDF.',
   isPremium: false },
   
  { id: 2005, 
  title: 'OLD is GOLD Question Bank', 
  link: 'https://drive.google.com/file/d/1H92WYzcYca456OIgi-xx78sdwAv35tsJ/view?usp=drive_link',
   description: 'All NEB chemistry model question papers in one PDF.',
  isPremium: false },
  
  { id: 2006, 
  title: 'NEB Solution of Physic',
  link: 'https://drive.google.com/file/d/1LPE32JyGu0n20MJheD1lq0o-6qLtokjK/view?usp=drive_link', 
   description: 'All NEB chemistry model question papers in one PDF.',
  isPremium: false },
],
    };

    // =================================================================================
    // ===== HELPER FUNCTIONS & UTILITIES =====
    // =================================================================================
    const getJSONFromLocalStorage = (key, defaultValue) => { try { const item = localStorage.getItem(key); return item ? JSON.parse(item) : defaultValue; } catch (error) { return defaultValue; } };
    const setJSONToLocalStorage = (key, value) => { try { localStorage.setItem(key, JSON.stringify(value)); } catch (error) { console.error("Could not save to localStorage", error); } };
    const getEmbedUrl = (url) => { if (!url) return null; const regex = /drive\.google\.com\/file\/d\/([a-zA-Z0-9_-]+)/; const match = url.match(regex); return match ? `https://drive.google.com/file/d/${match[1]}/preview` : null; };
    const generatePremiumCode = (name, stream) => {
        if (!name || name.length < 1 || !stream) return null;
        const getPrecedingAndSuccessiveChars = (char) => {
            const lowerChar = char.toLowerCase(); const code = lowerChar.charCodeAt(0);
            if (code < 97 || code > 122) return { preceding: 'x', successive: 'y' };
            const preceding = String.fromCharCode(code === 97 ? 122 : code - 1);
            const successive = String.fromCharCode(code === 122 ? 97 : code + 1);
            return { preceding, successive };
        };
        const thirdLetter = stream.length >= 3 ? stream.charAt(2) : 'x';
        const { preceding, successive } = getPrecedingAndSuccessiveChars(thirdLetter);
        return `${name.replace(/\s/g, '')}@1234${stream}${preceding}${successive}`;
    };

    class ErrorBoundary extends Component {
        constructor(props) { super(props); this.state = { hasError: false }; }
        static getDerivedStateFromError(error) { return { hasError: true }; }
        render() { if (this.state.hasError) { return <div className="p-8 text-center bg-red-100 dark:bg-red-900/50 text-red-700 dark:text-red-300 rounded-lg"><h2 className="font-bold text-2xl">Something went wrong.</h2><p>This part of the app encountered an error. Please try refreshing.</p></div>; } return this.props.children; }
    }
    
    const AppLoader = () => <div className="fixed inset-0 bg-slate-100 dark:bg-slate-950 flex flex-col items-center justify-center z-[10000]"><div className="text-center"><img src={DATA.logoUrl} alt="Logo" className="h-24 w-24 mx-auto mb-4 animate-pulse rounded-full" /><h1 className="text-4xl font-bold text-slate-800 dark:text-white mt-4 font-display">{DATA.appName}</h1><p className="text-slate-500 dark:text-slate-400">({DATA.appSubtitle})</p></div></div>;
    
    // =================================================================================
    // ===== MODALS & POPUPS =====
    // =================================================================================
    const PdfViewerModal = ({ note, onClose }) => {
        const embedUrl = getEmbedUrl(note.link);
        if (!embedUrl) return <div className="overlay"><div className="modal-box bg-white dark:bg-slate-800 p-8"><h3 className="font-bold text-red-500 text-xl">Invalid Document Link</h3><p className="mt-2">This note does not have a valid Google Drive link.</p><button onClick={onClose} className="mt-4 gradient-button px-4 py-2 rounded-full">Close</button></div></div>;
        return (
            <div className="overlay" onContextMenu={(e) => e.preventDefault()}>
                <div className="pdf-viewer-modal">
                    <div className="header">
                        <h3 className="truncate font-display font-semibold text-white"><i className="fas fa-file-pdf mr-3 text-teal-400"></i>{note.title}</h3>
                        <button onClick={onClose} className="h-8 w-8 grid place-items-center rounded-full bg-slate-700 hover:bg-slate-600 text-white" aria-label="Close PDF Viewer">&times;</button>
                    </div>
                    {/* The sandbox attribute is key for security */}
                    <iframe src={embedUrl} title={note.title} sandbox="allow-scripts allow-same-origin"></iframe>
                </div>
            </div>
        );
    };
    const PaymentModal = ({ onPaymentSuccess, onClose, userName, stream }) => {
        const [premiumCode, setPremiumCode] = useState('');
        const [isLoading, setIsLoading] = useState(false);
        const [error, setError] = useState('');
        const handleVerify = (e) => {
            e.preventDefault(); setError(''); const expectedCode = generatePremiumCode(userName, stream);
            if (premiumCode === expectedCode) {
                setIsLoading(true); setTimeout(() => { setIsLoading(false); onPaymentSuccess(); }, 1500);
            } else { setError('Invalid Premium Code. Please check and try again.'); }
        };
        return (
            <div className="overlay"><div className="modal-box bg-slate-900 text-white"><div className="p-8 bg-gradient-to-br from-teal-500 to-cyan-600"><i className="fas fa-rocket text-5xl mb-3"></i><h2 className="text-3xl font-extrabold font-display">Unlock Your Potential</h2><p className="text-white/80 mt-1">Get lifetime access to all premium content.</p></div><div className="p-8 text-left space-y-6"><div><span className="text-xs font-bold uppercase bg-slate-700 text-teal-300 px-2 py-1 rounded-full">Step 1: Payment</span><p className="text-white/80 mt-2">Send <span className="font-bold text-white">Rs. 199</span> to eSewa ID:</p><div className="bg-slate-800 border border-slate-700 p-3 rounded-lg mt-2 text-center text-xl font-mono tracking-widest">{DATA.esewaId}</div></div><div><span className="text-xs font-bold uppercase bg-slate-700 text-teal-300 px-2 py-1 rounded-full">Step 2: Activation</span><p className="text-white/80 mt-2">Contact admin on WhatsApp to get your code, then enter it below.</p><a href={DATA.whatsAppContactLink} target="_blank" rel="noopener noreferrer" className="inline-block mt-2 mb-3 bg-green-500 text-white font-bold py-2 px-4 rounded-full text-sm"><i className="fab fa-whatsapp mr-2"></i>Contact Admin</a><form onSubmit={handleVerify}><input type="text" value={premiumCode} onChange={(e) => setPremiumCode(e.target.value)} placeholder="Enter Premium Code" className="w-full p-3 border border-slate-700 rounded-md bg-slate-800 text-white focus:ring-2 focus:ring-teal-400 focus:outline-none" required />{error && <p className="text-red-400 text-sm mt-2 text-center">{error}</p>}<button type="submit" className="w-full gradient-button font-bold py-3 px-6 rounded-full shadow-lg text-lg mt-4" disabled={isLoading}>{isLoading ? 'Activating...' : 'Activate Premium'}</button></form></div><button onClick={onClose} className="text-slate-400 hover:text-white text-sm w-full mt-2">Maybe Later</button></div></div></div>
        );
    };

    const PresentationRequestModal = ({ user, onClose }) => {
        const [formData, setFormData] = useState({ subject: '', topic: '', specifics: '' });
        const handleSendRequest = () => {
            const message = `*Presentation Request*\n\n*Name:* ${user.name}\n*Grade:* ${user.grade}\n*Stream:* ${user.stream}\n\n*Subject:* ${formData.subject}\n*Topic:* ${formData.topic}\n\n*Specific Points to Cover:*\n${formData.specifics || 'N/A'}\n\n---\n_Sent from Ganesh Dai Academy_`;
            const whatsappUrl = `https://wa.me/${DATA.presentationRequestNumber}?text=${encodeURIComponent(message)}`;
            window.open(whatsappUrl, '_blank');
            onClose();
        };
        return (
            <div className="overlay"><div className="modal-box bg-white dark:bg-slate-900"><div className="p-8 text-left"><h2 className="text-2xl font-bold font-display">Request a Presentation</h2><p className="text-slate-500 dark:text-slate-400 mt-1 mb-6">Need a presentation on a specific topic? Fill out the form below.</p><div className="space-y-4"><input type="text" placeholder="Subject (e.g., Physics)" value={formData.subject} onChange={e => setFormData({...formData, subject: e.target.value})} className="w-full p-3 border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-800 rounded-md" /><input type="text" placeholder="Topic (e.g., Projectile Motion)" value={formData.topic} onChange={e => setFormData({...formData, topic: e.target.value})} className="w-full p-3 border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-800 rounded-md" /><textarea placeholder="Specific points or questions to cover..." value={formData.specifics} onChange={e => setFormData({...formData, specifics: e.target.value})} rows="3" className="w-full p-3 border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-800 rounded-md"></textarea></div><div className="flex gap-4 mt-6"><button onClick={onClose} className="w-full py-3 rounded-full bg-slate-200 dark:bg-slate-700 font-bold">Cancel</button><button onClick={handleSendRequest} className="w-full gradient-button font-bold py-3 rounded-full flex items-center justify-center gap-2"><i className="fab fa-whatsapp"></i> Send Request</button></div></div></div></div>
        );
    };
    
    // =================================================================================
    // ===== ONBOARDING =====
    // =================================================================================
    const WelcomeScreen = ({ onSetupComplete }) => {
        const [step, setStep] = useState(1);
        const [userData, setUserData] = useState({ name: '', stream: '', grade: '', optionals: [] });
        const selectedStreamData = DATA.streams.find(s => s.id === userData.stream);
        
        const handleOptionalSelect = (subject, max) => {
             if (max === 1) { setUserData(prev => ({ ...prev, optionals: [subject] })); } 
             else { const newOptionals = userData.optionals.includes(subject) ? userData.optionals.filter(s => s !== subject) : [...userData.optionals, subject]; if (newOptionals.length <= max) { setUserData(prev => ({ ...prev, optionals: newOptionals })); } }
        };

        const handleSubmit = (e) => {
            e.preventDefault();
            if(step === 1 && userData.name && userData.stream && userData.grade) { setStep(2); } 
            else if (step === 2) { onSetupComplete(userData.name, userData.stream, userData.grade, userData.optionals); }
        };
        return (
            <div className="min-h-screen w-full flex items-center justify-center p-4 bg-slate-900 bg-cover bg-center" style={{backgroundImage: "linear-gradient(rgba(2,6,23,0.8), rgba(2,6,23,0.8)), url('https://images.unsplash.com/photo-1524995997946-a1c2e315a42f?q=80&w=2070&auto=format&fit=crop')"}}>
                <div className="w-full max-w-md bg-slate-800/50 backdrop-blur-md rounded-2xl p-8 shadow-2xl animate-popIn">
                    <div className="text-center mb-8"><img src={DATA.logoUrl} alt="Logo" className="h-20 w-20 mx-auto rounded-full" /><h1 className="text-4xl font-bold text-white mt-4 font-display">Welcome to {DATA.appName}</h1><p className="text-slate-300 mt-2">Your +2 academic command center.</p></div>
                    <form onSubmit={handleSubmit}>
                        {step === 1 ? (
                            <div className="space-y-4 animate-fadeIn">
                                <input type="text" value={userData.name} onChange={(e) => setUserData(p => ({...p, name: e.target.value}))} placeholder="Enter Your Name" className="w-full px-4 py-3 rounded-lg border-0 bg-slate-900/50 text-white placeholder-slate-400 focus:ring-2 focus:ring-teal-400" required />
                                <select value={userData.grade} onChange={(e) => setUserData(p => ({...p, grade: e.target.value}))} className="w-full px-4 py-3 rounded-lg border-0 bg-slate-900/50 text-white" required><option value="" disabled>Select Your Grade</option><option value="11">Grade 11</option><option value="12">Grade 12</option></select>
                                <select value={userData.stream} onChange={(e) => setUserData(p => ({...p, stream: e.target.value, optionals: []}))} className="w-full px-4 py-3 rounded-lg border-0 bg-slate-900/50 text-white" required><option value="" disabled>Select Your Stream</option>{DATA.streams.map(s => <option key={s.id} value={s.id}>{s.name}</option>)}</select>
                                <button type="submit" className="w-full gradient-button font-bold py-3 rounded-full text-lg mt-4" disabled={!userData.stream}>Next <i className="fas fa-arrow-right ml-2"></i></button>
                            </div>
                        ) : (
                            <div className="space-y-4 animate-fadeIn">
                                <h3 className="text-white font-bold text-lg">Select Your Optional Subjects</h3>
                                {selectedStreamData && selectedStreamData.optional.flat().map(sub => (
                                    <label key={sub} className={`flex items-center p-3 rounded-lg border-2 ${userData.optionals.includes(sub) ? 'bg-teal-500/30 border-teal-400' : 'bg-slate-900/50 border-slate-700'}`}>
                                        <input type={selectedStreamData.optional_count === 1 ? 'radio' : 'checkbox'} name="optional" checked={userData.optionals.includes(sub)} onChange={() => handleOptionalSelect(sub, selectedStreamData.optional_count)} className="h-4 w-4 text-teal-500 bg-slate-800 border-slate-600 focus:ring-teal-500" />
                                        <span className="ml-3 text-white">{sub}</span>
                                    </label>
                                ))}
                                <button type="submit" className="w-full gradient-button font-bold py-3 rounded-full text-lg mt-4" disabled={userData.optionals.length === 0 || userData.optionals.length > selectedStreamData.optional_count}>Start Studying</button>
                            </div>
                        )}
                    </form>
                </div>
            </div>
        );
    };
    
    // =================================================================================
    // ===== PAGE SECTIONS & COMPONENTS =====
    // =================================================================================
    const NoteCard = ({ note, isBookmarked, onBookmark, onView, isPremiumUser, onGoPremium, style }) => (
        <div onClick={() => (note.isPremium && !isPremiumUser) ? onGoPremium() : onView(note)} style={style} className="p-5 rounded-xl shadow-lg hover:shadow-2xl hover:-translate-y-2 transition-all duration-300 cursor-pointer flex flex-col justify-between text-white relative overflow-hidden">
            <div className="absolute inset-0 bg-black/30"></div>
            <div className="relative z-10">
                <div className="flex justify-between items-start">
                    <h4 className="font-bold text-lg pr-2">{note.title}</h4>
                    <button onClick={(e) => { e.stopPropagation(); onBookmark(note.id); }} className={`flex-shrink-0 text-2xl ${isBookmarked ? 'text-teal-300' : 'text-white/50 hover:text-white'}`}>
                        <i className={`${isBookmarked ? 'fas' : 'far'} fa-bookmark`}></i>
                    </button>
                </div>
                <p className="text-sm text-white/70 mt-1">Grade {note.grade} &bull; {note.subject}</p>
            </div>
            <div className="mt-4 flex justify-between items-center relative z-10">
                {note.isPremium && <span className="flex items-center gap-2 text-xs font-bold text-amber-300 uppercase"><i className="fas fa-star"></i>Premium</span>}
                <div className={`${!note.isPremium ? 'invisible' : ''}`}></div>
                <i className={`fas ${note.isPremium && !isPremiumUser ? 'fa-lock' : 'fa-arrow-right'} text-white/50`}></i>
            </div>
        </div>
    );
    
    
    const Dashboard = ({ user, setActiveSection, lastViewedNote }) => {
        const streamInfo = DATA.streams.find(s => s.id === user.stream);
        const quote = DATA.motivationalQuotes[new Date().getDate() % DATA.motivationalQuotes.length];
        const ActionCard = ({ icon, title, description, onClick }) => (<button onClick={onClick} className="p-6 bg-white dark:bg-slate-800/50 rounded-2xl shadow-md text-left w-full hover:shadow-xl hover:-translate-y-1.5 transition-all duration-300"><i className={`${icon} text-3xl text-teal-500 mb-3`}></i><h3 className="font-bold text-xl font-display">{title}</h3><p className="text-slate-500 dark:text-slate-400 text-sm">{description}</p></button>);
        return (<div className="p-4 md:p-6 space-y-8 animate-fadeIn"><div className="bg-gradient-to-br from-teal-600 to-cyan-700 text-white p-8 rounded-2xl shadow-lg relative overflow-hidden"><div className="absolute -right-10 -top-10 text-white/10 text-9xl transform rotate-12"><i className="fas fa-graduation-cap"></i></div><h1 className="text-4xl font-bold font-display relative z-10">Welcome, {user.name}!</h1><p className="mt-2 text-lg opacity-90 relative z-10">Your Grade {user.grade} <span className="font-semibold">{streamInfo?.name}</span> hub is ready.</p></div><div className="grid grid-cols-1 md:grid-cols-3 gap-6"><ActionCard icon="fas fa-compass" title="Explore Notes" description="Browse all notes for your stream." onClick={() => setActiveSection({name: 'explorer'})} /><ActionCard icon="fas fa-feather-alt" title="Exam Prep" description="Find routines, checklists & model questions." onClick={() => setActiveSection({name: 'examprep'})} /><ActionCard icon="fas fa-tools" title="Quick Tools" description="GPA Calculator, unit converter, and more." onClick={() => setActiveSection({name: 'tools'})} /></div><div className="grid grid-cols-1 lg:grid-cols-2 gap-6">{lastViewedNote && (<div className="p-6 bg-white dark:bg-slate-800/50 rounded-2xl shadow-md"><h3 className="font-bold text-lg mb-3">Continue Studying</h3><div className="border-l-4 border-teal-500 pl-4 py-2 hover:bg-slate-50 dark:hover:bg-slate-800 rounded-r-md cursor-pointer" onClick={() => setActiveSection({name:'explorer'})}><p className="font-semibold">{lastViewedNote.title}</p><p className="text-sm text-slate-500">{lastViewedNote.subject} - Grade {lastViewedNote.grade}</p></div></div>)}<div className="p-6 bg-white dark:bg-slate-800/50 rounded-2xl shadow-md flex items-center"><i className="fas fa-lightbulb text-4xl text-amber-400 mr-4"></i><div><h3 className="font-bold text-lg">Quote of the Day</h3><p className="text-slate-600 dark:text-slate-300 italic">"{quote}"</p></div></div></div></div>);
    };

    const NotesExplorer = ({ user, isPremium, bookmarkedNotes, onBookmark, onViewNote, onGoPremium }) => {
        const streamSubjects = useMemo(() => { const streamInfo = DATA.streams.find(s => s.id === user.stream); return [...(streamInfo?.compulsory || []), ...(user.optionals || [])]; }, [user]);
        const [searchTerm, setSearchTerm] = useState('');
        const [filters, setFilters] = useState({ grade: user.grade, subject: 'all' });
        const filteredNotes = useMemo(() => DATA.notes.filter(note => (filters.subject === 'all' ? streamSubjects.includes(note.subject) : note.subject === filters.subject) && (note.title.toLowerCase().includes(searchTerm.toLowerCase())) && (filters.grade === 'all' || note.grade == filters.grade)), [searchTerm, filters, streamSubjects]);
        
        const cardGradients = [ 'from-cyan-500 to-blue-500', 'from-sky-500 to-indigo-500', 'from-violet-500 to-purple-500', 'from-fuchsia-500 to-pink-500', 'from-rose-500 to-red-500' ];

        return (<div className="p-4 md:p-6 animate-fadeIn"><h2 className="text-3xl font-bold font-display mb-6">Note Explorer</h2><div className="sticky top-0 z-30 bg-slate-100/80 dark:bg-slate-950/80 backdrop-blur-sm p-4 -mx-4 md:-mx-6 mb-6 rounded-b-lg"><div className="relative mb-4"><i className="fas fa-search absolute left-4 top-1/2 -translate-y-1/2 text-slate-400"></i><input type="text" placeholder="Search notes by title..." value={searchTerm} onChange={e => setSearchTerm(e.target.value)} className="w-full pl-12 pr-4 py-3 rounded-full border-2 border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-800 focus:ring-2 focus:ring-teal-500 focus:border-transparent transition" /></div><div className="flex items-center gap-4"><select value={filters.grade} onChange={e => setFilters(p => ({...p, grade: e.target.value}))} className="w-1/3 py-3 px-4 rounded-full border-2 dark:border-slate-700 bg-white dark:bg-slate-800"><option value="all">All Grades</option><option value="11">Grade 11</option><option value="12">Grade 12</option></select><select value={filters.subject} onChange={e => setFilters(p => ({...p, subject: e.target.value}))} className="w-2/3 py-3 px-4 rounded-full border-2 dark:border-slate-700 bg-white dark:bg-slate-800"><option value="all">All My Subjects</option>{streamSubjects.map(sub => <option key={sub} value={sub}>{sub}</option>)}</select></div></div><div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">{filteredNotes.map((note, i) => <div key={note.id} style={{ animationDelay: `${i * 30}ms` }} className="animate-fadeIn"><NoteCard note={note} isBookmarked={bookmarkedNotes.includes(note.id)} onBookmark={onBookmark} onView={onViewNote} isPremiumUser={isPremium} onGoPremium={onGoPremium} style={{ background: `linear-gradient(45deg, var(--tw-gradient-stops))`}} className={`bg-gradient-to-br ${cardGradients[i % cardGradients.length]}`} /></div>)}</div></div>);
    };
    // Paste this after NotesExplorer (before MyStudyList or near other sections)
const DigitalLibrary = ({ user, isPremium, onViewNote, onGoPremium }) => {
  const [search, setSearch] = useState('');
  const items = DATA.digitalLibrary || [];
  const filtered = items.filter(it =>
    it.title.toLowerCase().includes(search.toLowerCase()) ||
    (it.description || '').toLowerCase().includes(search.toLowerCase())
  );

  return (
    <div className="p-4 md:p-6 animate-fadeIn">
      <h2 className="text-3xl font-bold font-display mb-4">Digital Library</h2>

      <div className="mb-6">
        <input
          value={search}
          onChange={(e) => setSearch(e.target.value)}
          placeholder="Search library..."
          className="w-full pl-4 pr-4 py-3 rounded-full border-2 dark:border-slate-700 bg-white dark:bg-slate-800 focus:ring-2 focus:ring-teal-500"
        />
      </div>

      <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
        {filtered.map(item => (
          <div key={item.id} className="p-5 rounded-xl shadow-lg bg-white dark:bg-slate-800 text-slate-800 dark:text-slate-200">
            <div className="flex justify-between items-start">
              <div>
                <h4 className="font-bold text-lg">{item.title}</h4>
                <p className="text-sm text-slate-500 dark:text-slate-400 mt-1">{item.description}</p>
              </div>
              {item.isPremium && !isPremium && <span className="text-amber-400 text-sm font-bold">Premium</span>}
            </div>

            <div className="mt-4 flex gap-2">
              {(!item.isPremium || isPremium) ? (
                <button
                  onClick={() => onViewNote && onViewNote({
                    id: item.id,
                    title: item.title,
                    link: item.link,
                  })}
                  className="px-3 py-2 rounded-full bg-teal-500 text-white font-semibold text-sm"
                >
                  Open PDF
                </button>
              ) : (
                <button
                  onClick={onGoPremium}
                  className="px-3 py-2 rounded-full border text-sm text-amber-500"
                >
                  Unlock
                </button>
              )}
            </div>
          </div>
        ))}
        {filtered.length === 0 && <p className="text-slate-500 dark:text-slate-400">No items found.</p>}
      </div>
    </div>
  );
};
const AboutSection = ({ user }) => {
  return (
    <div className="p-4 md:p-6 animate-fadeIn">
      <h2 className="text-3xl font-bold font-display mb-4">About {DATA.appName}</h2>

      <div className="bg-white dark:bg-slate-800 rounded-2xl p-6 shadow-md space-y-4">
        <p className="text-slate-600 dark:text-slate-300 leading-relaxed">
          {DATA.appName} — {DATA.appSubtitle}. This learning hub bundles notes, past
          questions, exam checklists and quick study tools for Grade 11 & 12 students.
          Built to be small, responsive and offline-friendly.
          
          <div className="space-y-4">
  <h4 className="font-semibold">Disclaimer</h4>
  <p className="text-sm text-slate-500 leading-relaxed">
    Most of the study materials, PDFs, and documents available on this platform are created and compiled by me. 
    However, some files have been collected from various online sources such as educational websites, Facebook groups, 
    and public archives — solely for educational and reference purposes. 
    The aim is to make it easier for students to find all essential resources in one place. 
    All rights and credits go to the respective authors and content owners. 
    If you are a copyright holder and would like your material removed or credited differently, 
    please contact me, and I will respond promptly.
  </p>
</div>

        </p>

        <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
          <div>
            <h4 className="font-semibold">Founder</h4>
            <p className="text-sm text-slate-500">Ganesh Dahal</p>
          </div>
          <div>
            <h4 className="font-semibold">Version</h4>
            <p className="text-sm text-slate-500">v1.0.0</p>
          </div>

          <div className="md:col-span-2">
            <h4 className="font-semibold">Contact & Socials</h4>
            <p className="text-sm text-slate-500">
              <a href={DATA.socials.facebook} target="_blank" rel="noopener noreferrer" className="underline">Facebook</a>
              {' · '}
              <a href={DATA.socials.youtube} target="_blank" rel="noopener noreferrer" className="underline">YouTube</a>
            </p>
          </div>

          <div className="md:col-span-2">
            <h4 className="font-semibold">Mission</h4>
            <p className="text-sm text-slate-500">Provide concise, exam-focused resources and practical tools to help students succeed in +2 NEB exams.</p>
          </div>
        </div>

        <div className="pt-2 border-t dark:border-slate-700">
          <button onClick={() => alert('Thanks for checking the About page!')} className="mt-3 gradient-button px-4 py-2 rounded-full text-white font-bold">Say Hi</button>
        </div>
      </div>
    </div>
  );
};
 const MyStudyList = ({ bookmarkedNotes, allNotes, onBookmark, onViewNote, isPremium, onGoPremium, setActiveSection }) => {
        const notes = useMemo(() => allNotes.filter(n => bookmarkedNotes.includes(n.id)), [bookmarkedNotes, allNotes]);
        return (<div className="p-4 md:p-6 animate-fadeIn"><h2 className="text-3xl font-bold font-display mb-2">My Study List</h2><p className="text-slate-500 dark:text-slate-400 mb-6">Your hand-picked collection of important notes.</p>{notes.length > 0 ? <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">{notes.map(note => <NoteCard key={note.id} note={note} isBookmarked={true} onBookmark={onBookmark} onView={onViewNote} isPremiumUser={isPremium} onGoPremium={onGoPremium}/>)}</div> : <div className="text-center py-20 bg-white dark:bg-slate-800/50 rounded-2xl"><i className="far fa-bookmark text-6xl text-slate-400"></i><h3 className="mt-4 text-2xl font-bold">Your Study List is Empty</h3><p className="mt-2 text-slate-500">Click the bookmark icon on any note to add it here.</p><button onClick={() => setActiveSection({name: 'explorer'})} className="mt-6 gradient-button font-bold py-3 px-6 rounded-full">Explore Notes</button></div>}</div>);
    };
    const GpaCalculator = ({ user, onDownload }) => {
        const streamInfo = DATA.streams.find(s => s.id === user.stream);
        const userSubjects = [...(streamInfo?.compulsory || []), ...(user.optionals || [])];
        const initialSubjects = userSubjects.map(name => ({ name, credits: DATA.subjectData[name]?.credits ?? 0, grade: '' })).filter(s => s.credits > 0);
        const [subjects, setSubjects] = useState(initialSubjects);

        const { gpa, percentage, results } = useMemo(() => {
            let totalCredits = 0, totalWeightedPoints = 0; let hasNG = false;
            const detailedResults = subjects.map(s => {
                if(s.grade === 'NG') hasNG = true;
                const gp = DATA.gradePoints[s.grade] || 0.0;
                const weighted = gp * s.credits;
                if(s.grade && s.grade !== 'NG') { totalCredits += s.credits; totalWeightedPoints += weighted; }
                return { ...s, gp, weighted };
            });
            const finalGpa = totalCredits > 0 ? (totalWeightedPoints / totalCredits) : 0.0;
            return { gpa: hasNG ? '0.00' : finalGpa.toFixed(2), percentage: hasNG ? '0.00' : (finalGpa / 4 * 100).toFixed(2), results: detailedResults };
        }, [subjects]);

        const GPAResultCard = ({ user, gpa, results, percentage }) => ( <div id="gpa-result-card" className="p-8 bg-white text-slate-800 rounded-lg shadow-inner"><div className="flex items-center justify-between pb-4 border-b-2"><div className="flex items-center gap-3"><img src={DATA.logoUrl} alt="Logo" className="h-16 w-16 rounded-full" /><div><h2 className="text-2xl font-bold font-display">{DATA.appName}</h2><p className="text-sm text-slate-500">Grade Point Average (GPA) Report</p></div></div><div className="text-right"><p className="font-bold">{user.name}</p><p className="text-sm text-slate-600">Grade {user.grade} ({user.stream})</p></div></div><div className="my-6"><table className="w-full text-left"><thead><tr className="bg-slate-100"><th className="p-2">Subject</th><th className="p-2 text-center">Grade</th><th className="p-2 text-center">Grade Point</th></tr></thead><tbody>{results.map(r => r.grade && <tr key={r.name} className="border-b border-slate-100"><td className="p-2">{r.name}</td><td className="p-2 text-center font-semibold">{r.grade}</td><td className="p-2 text-center">{r.grade === 'NG' ? 'N/A' : r.gp.toFixed(2)}</td></tr>)}</tbody></table></div><div className="text-center mt-6 p-4 bg-teal-50 rounded-lg flex justify-around"><div className="px-4"><p className="text-lg font-semibold text-teal-800">Final GPA</p><p className="text-5xl font-extrabold text-teal-600 font-display">{gpa}</p></div><div className="border-l-2"></div><div className="px-4"><p className="text-lg font-semibold text-teal-800">Percentage</p><p className="text-5xl font-extrabold text-teal-600 font-display">{percentage}%</p></div></div><p className="text-xs text-center text-slate-400 mt-4">Generated on {new Date().toLocaleDateString()}</p></div>);
        return ( <div className="p-6 bg-white dark:bg-slate-800/50 rounded-xl shadow-md"><h2 className="text-2xl font-bold font-display mb-4">NEB GPA & Percentage Calculator</h2><div className="overflow-x-auto"><table className="w-full text-left"><thead><tr className="bg-slate-100 dark:bg-slate-700/50"><th className="p-2 rounded-tl-lg">Subject</th><th className="p-2">Credits</th><th className="p-2 rounded-tr-lg">Grade</th></tr></thead><tbody>{subjects.map((s, i) => <tr key={i} className="border-b dark:border-slate-700"><td className="p-2 font-semibold">{s.name}</td><td className="p-2 text-center">{s.credits}</td><td className="p-2"><select value={s.grade} onChange={(e) => setSubjects(subjects.map((sub, idx) => i === idx ? {...sub, grade: e.target.value} : sub))} className="w-full py-2 px-3 rounded-md border dark:border-slate-600 bg-white dark:bg-slate-700"><option value="">-</option>{Object.keys(DATA.gradePoints).map(g => <option key={g} value={g}>{g}</option>)}</select></td></tr>)}</tbody></table></div><div className="mt-6 border-t dark:border-slate-700 pt-4"><GPAResultCard user={user} gpa={gpa} results={results} percentage={percentage} /><button onClick={() => onDownload('gpa-result-card')} className="w-full mt-4 gradient-button font-bold py-3 rounded-full flex items-center justify-center gap-2"><i className="fas fa-download"></i> Download Report Card</button></div></div>);
    };

    const UnitConverter = () => {
        const [category, setCategory] = useState('length'); const [inputValue, setInputValue] = useState(1); const [fromUnit, setFromUnit] = useState('m'); const [toUnit, setToUnit] = useState('cm');
        const units = { length: { m: 1, cm: 0.01, ft: 0.3048, in: 0.0254, km: 1000, yd: 0.9144, mi: 1609.34 }, weight: { kg: 1, g: 0.001, lb: 0.453592 }, temperature: {} };
        const conversionResult = useMemo(() => {
            const val = parseFloat(inputValue);
            if(isNaN(val)) return 0;
            if (category === 'temperature') { if(fromUnit === 'C' && toUnit === 'F') return (val * 9/5) + 32; if(fromUnit === 'F' && toUnit === 'C') return (val - 32) * 5/9; return val; }
            const valueInBase = val * (units[category]?.[fromUnit] ?? 1); const result = valueInBase / (units[category]?.[toUnit] ?? 1); return parseFloat(result.toFixed(5));
        }, [inputValue, fromUnit, toUnit, category]);
        const handleCategoryChange = (cat) => { setCategory(cat); if(cat === 'length') { setFromUnit('m'); setToUnit('cm'); } if(cat === 'weight') { setFromUnit('kg'); setToUnit('g'); } if(cat === 'temperature') { setFromUnit('C'); setToUnit('F'); } }
        const currentUnits = category === 'temperature' ? { 'C': 'Celsius', 'F': 'Fahrenheit' } : units[category];
        return (<div className="p-6 bg-white dark:bg-slate-800/50 rounded-xl shadow-md"><h3 className="font-bold text-xl mb-4">Unit Converter</h3><div className="flex gap-2 mb-4">{Object.keys(units).map(cat => <button key={cat} onClick={()=>handleCategoryChange(cat)} className={`capitalize flex-1 py-2 text-sm font-semibold rounded-full ${category === cat ? 'bg-teal-500 text-white' : 'bg-slate-200 dark:bg-slate-700'}`}>{cat}</button>)}</div><div className="flex items-center gap-2"><input type="number" value={inputValue} onChange={e=>setInputValue(e.target.value)} className="w-full p-2 border rounded-md dark:bg-slate-700 dark:border-slate-600" /><select value={fromUnit} onChange={e=>setFromUnit(e.target.value)} className="p-2 border rounded-md dark:bg-slate-700 dark:border-slate-600">{Object.keys(currentUnits).map(u => <option key={u} value={u}>{u}</option>)}</select></div><div className="text-center my-2 font-bold text-2xl">=</div><div className="flex items-center gap-2"><input type="number" value={conversionResult} readOnly className="w-full p-2 border rounded-md dark:bg-slate-700 dark:border-slate-600 bg-slate-100 dark:bg-slate-900" /><select value={toUnit} onChange={e=>setToUnit(e.target.value)} className="p-2 border rounded-md dark:bg-slate-700 dark:border-slate-600">{Object.keys(currentUnits).map(u => <option key={u} value={u}>{u}</option>)}</select></div></div>);
    };

    const PomodoroTimer = () => {
        const [time, setTime] = useState(25 * 60); const [isActive, setIsActive] = useState(false); const [duration, setDuration] = useState(25 * 60);
        useEffect(() => { let interval = null; if (isActive && time > 0) { interval = setInterval(() => { setTime(t => t - 1); }, 1000); } else if (time === 0) { setIsActive(false); } return () => clearInterval(interval); }, [isActive, time]);
        const toggle = () => setIsActive(!isActive);
        const reset = (newDuration) => { setDuration(newDuration); setTime(newDuration); setIsActive(false); };
        const formatTime = (t) => `${String(Math.floor(t / 60)).padStart(2,'0')}:${String(t % 60).padStart(2,'0')}`;
        return (<div className="p-6 bg-white dark:bg-slate-800/50 rounded-xl shadow-md text-center"><h3 className="font-bold text-xl mb-4">Pomodoro Timer</h3><div className="flex justify-center gap-2 mb-4">{[25, 45, 60].map(d => <button key={d} onClick={()=>reset(d * 60)} className={`px-3 py-1 text-sm font-semibold rounded-full ${duration === d * 60 ? 'bg-teal-500 text-white' : 'bg-slate-200 dark:bg-slate-700'}`}>{d} min</button>)}</div><div className="text-6xl font-bold font-mono p-4 rounded-lg text-teal-500">{formatTime(time)}</div><div className="mt-4 flex gap-4 justify-center"><button onClick={toggle} className="px-6 py-2 rounded-full font-semibold bg-slate-200 dark:bg-slate-700">{isActive ? 'Pause' : 'Start'}</button><button onClick={()=>reset(duration)} className="px-6 py-2 rounded-full font-semibold bg-slate-200 dark:bg-slate-700">Reset</button></div></div>);
    };

    const BrainTeaser = () => {
        const [teaser, setTeaser] = useState(DATA.brainTeasers[0]);
        const [guess, setGuess] = useState('');
        const [result, setResult] = useState('');
        const checkAnswer = (e) => {
            e.preventDefault();
            if(guess.toLowerCase().trim() === teaser.answer.toLowerCase()) { setResult('correct'); }
            else { setResult('incorrect'); }
        };
        const nextTeaser = () => {
            setResult(''); setGuess('');
            setTeaser(DATA.brainTeasers[Math.floor(Math.random() * DATA.brainTeasers.length)]);
        };
        return (
            <div className="p-6 bg-white dark:bg-slate-800/50 rounded-xl shadow-md"><h3 className="font-bold text-xl mb-4">Brain Teaser</h3><p className="text-slate-600 dark:text-slate-400 italic mb-4">"{teaser.question}"</p><form onSubmit={checkAnswer} className="flex gap-2"><input type="text" value={guess} onChange={e=>setGuess(e.target.value)} placeholder="Your answer..." className="w-full p-2 border rounded-md dark:bg-slate-700 dark:border-slate-600" /><button type="submit" className="px-4 py-2 font-semibold rounded-md bg-teal-500 text-white">Check</button></form>{result && <div className={`mt-3 p-2 rounded-md text-center font-semibold ${result === 'correct' ? 'bg-green-100 text-green-700' : 'bg-red-100 text-red-700'}`}>{result === 'correct' ? 'Correct!' : 'Try again!'}</div>}<button onClick={nextTeaser} className="text-sm mt-3 text-slate-500 hover:text-teal-500">Next Teaser <i className="fas fa-sync-alt"></i></button></div>
        );
    }

    const QuickTools = ({ user }) => {
        const handleDownload = (elementId) => html2canvas(document.getElementById(elementId), { scale: 2 }).then(canvas => { const link = document.createElement('a'); link.download = `GDA_GPA_Report_${user.name}.png`; link.href = canvas.toDataURL('image/png'); link.click(); });
        return (<div className="p-4 md:p-6 animate-fadeIn"><h2 className="text-3xl font-bold font-display mb-6">Quick Tools</h2><div className="grid grid-cols-1 lg:grid-cols-2 gap-6 items-start"><GpaCalculator user={user} onDownload={handleDownload} /><div className="space-y-6"><UnitConverter /><PomodoroTimer /><BrainTeaser /></div></div></div>);
    };

    const ExamPrepSection = ({ user }) => {
        const [activeTab, setActiveTab] = useState('routines');
        const ExamChecklist = ({ checklist }) => {
            const [checkedItems, setCheckedItems] = useState(() => getJSONFromLocalStorage(checklist.id, []));
            const handleCheck = (item) => { const newChecked = checkedItems.includes(item) ? checkedItems.filter(i => i !== item) : [...checkedItems, item]; setCheckedItems(newChecked); setJSONToLocalStorage(checklist.id, newChecked);};
            const progress = (checklist.items.length > 0) ? (checkedItems.length / checklist.items.length) * 100 : 0;
            return(<div className="p-6 bg-white dark:bg-slate-800/50 rounded-xl shadow-md"><h3 className="font-bold text-xl mb-4">{checklist.subject} Revision Checklist</h3><div className="w-full bg-slate-200 dark:bg-slate-700 rounded-full h-2.5 mb-4"><div className="bg-teal-500 h-2.5 rounded-full" style={{width: `${progress}%`}}></div></div><div className="space-y-3">{checklist.items.map(item => <label key={item} className="flex items-center gap-3 cursor-pointer"><input type="checkbox" checked={checkedItems.includes(item)} onChange={() => handleCheck(item)} className="h-4 w-4 rounded border-gray-300 text-teal-600 focus:ring-teal-500" /><span>{item}</span></label>)}</div></div>);
        };
        const streamInfo = DATA.streams.find(s => s.id === user.stream);
        const userSubjects = [...(streamInfo?.compulsory || []), ...(user.optionals || [])];
        const streamChecklists = DATA.examPreps.checklists.filter(c => userSubjects.includes(c.subject));
        
        return (<div className="p-4 md:p-6 animate-fadeIn"><h2 className="text-3xl font-bold font-display mb-6">Exam Preparation</h2><div className="flex border-b-2 dark:border-slate-700 mb-6"><button onClick={()=>setActiveTab('routines')} className={`px-4 py-2 font-semibold ${activeTab === 'routines' ? 'border-b-2 border-teal-500 text-teal-500' : 'text-slate-500'}`}>Upcoming Exams</button><button onClick={()=>setActiveTab('checklists')} className={`px-4 py-2 font-semibold ${activeTab === 'checklists' ? 'border-b-2 border-teal-500 text-teal-500' : 'text-slate-500'}`}>Checklists</button><button onClick={()=>setActiveTab('models')} className={`px-4 py-2 font-semibold ${activeTab === 'models' ? 'border-b-2 border-teal-500 text-teal-500' : 'text-slate-500'}`}>Model Questions</button></div><div>{activeTab === 'routines' && <div className="p-6 bg-white dark:bg-slate-800/50 rounded-xl shadow-md"><h3 className="font-bold text-xl mb-4">NEB Exam Routine (Sample)</h3><table className="w-full text-left"><thead><tr className="border-b-2 dark:border-slate-700"><th className="p-2">Subject</th><th className="p-2">Date</th></tr></thead><tbody>{DATA.examPreps.routines.map(r => <tr key={r.subject} className="border-b dark:border-slate-800"><td className="p-2">{r.subject}</td><td className="p-2">{r.date}</td></tr>)}</tbody></table></div>}{activeTab === 'checklists' && <div className="space-y-6">{streamChecklists.map(c => <ExamChecklist key={c.id} checklist={c}/>)}</div>}{activeTab === 'models' && <div className="p-6 bg-white dark:bg-slate-800/50 rounded-xl shadow-md"><div className="space-y-3">{DATA.examPreps.modelQuestions.map(mq => <a href={mq.link} target="_blank" key={mq.id} className="block p-3 bg-slate-100 dark:bg-slate-700/50 rounded-md hover:bg-slate-200 dark:hover:bg-slate-700 font-semibold">{mq.title} {mq.isPremium && <i className="fas fa-star text-amber-500 text-xs ml-1"></i>}</a>)}</div></div>}</div></div>);
    };

    // =================================================================================
    // ===== MAIN APP COMPONENT =====
    // =================================================================================
    const App = () => {
        const [user, setUser] = useState(null);
        const [isLoading, setIsLoading] = useState(true);
        const [activeSection, setActiveSection] = useState({ name: 'dashboard' });
        const [isPremium, setIsPremium] = useState(false);
        const [bookmarkedNotes, setBookmarkedNotes] = useState([]);
        const [lastViewedNoteId, setLastViewedNoteId] = useState(null);
        const [viewingNote, setViewingNote] = useState(null);
        const [showPaymentModal, setShowPaymentModal] = useState(false);
        const [showPresentationModal, setShowPresentationModal] = useState(false);

        useEffect(() => {
            const storedUser = getJSONFromLocalStorage('gdaUser', null);
            if (storedUser && storedUser.optionals) {
                setUser(storedUser);
                setIsPremium(getJSONFromLocalStorage(`gdaPremium_${storedUser.stream}`, false));
                setBookmarkedNotes(getJSONFromLocalStorage('gdaBookmarkedNotes', []));
                setLastViewedNoteId(getJSONFromLocalStorage('gdaLastViewedNoteId', null));
            }
            setTimeout(() => setIsLoading(false), 1200);
        }, []);
        
        const handleSetupComplete = (name, stream, grade, optionals) => { const newUser = { name, stream, grade, optionals }; setUser(newUser); setJSONToLocalStorage('gdaUser', newUser); };
        const handleLogout = () => { if (window.confirm("Are you sure you want to log out? This will clear your profile and all saved data.")) { Object.keys(localStorage).filter(k => k.startsWith('gda') || k.endsWith('_checklist')).forEach(k => localStorage.removeItem(k)); window.location.reload(); } };
        const handleBookmark = (noteId) => { const newBookmarks = bookmarkedNotes.includes(noteId) ? bookmarkedNotes.filter(id => id !== noteId) : [...bookmarkedNotes, noteId]; setBookmarkedNotes(newBookmarks); setJSONToLocalStorage('gdaBookmarkedNotes', newBookmarks); };
        const handleViewNote = (note) => { setViewingNote(note); setLastViewedNoteId(note.id); setJSONToLocalStorage('gdaLastViewedNoteId', note.id); };
        const handlePremiumUnlock = () => { setIsPremium(true); setJSONToLocalStorage(`gdaPremium_${user.stream}`, true); setShowPaymentModal(false); alert("Congratulations! Premium access for this stream has been unlocked."); };

        const renderSection = () => {
            const lastViewedNote = DATA.notes.find(n => n.id === lastViewedNoteId);
            switch(activeSection.name) {
                case 'dashboard': return <Dashboard user={user} setActiveSection={setActiveSection} lastViewedNote={lastViewedNote} />;
                case 'explorer': return <NotesExplorer user={user} isPremium={isPremium} bookmarkedNotes={bookmarkedNotes} onBookmark={handleBookmark} onViewNote={handleViewNote} onGoPremium={() => setShowPaymentModal(true)} />;
                case 'studylist': return <MyStudyList bookmarkedNotes={bookmarkedNotes} allNotes={DATA.notes} onBookmark={handleBookmark} onViewNote={handleViewNote} isPremium={isPremium} onGoPremium={() => setShowPaymentModal(true)} setActiveSection={setActiveSection}/>;
                case 'tools': return <QuickTools user={user} />;
                case 'examprep': return <ExamPrepSection user={user} />;
                 case 'library':
      return (
        <DigitalLibrary
          user={user}
          isPremium={isPremium}
          onViewNote={handleViewNote}
          onGoPremium={() => setShowPaymentModal(true)}
        />
      );
      case 'about':
  return <AboutSection user={user} />;

                default: return <Dashboard user={user} setActiveSection={setActiveSection} lastViewedNote={lastViewedNote} />;
            }
        };

        if (isLoading) return <AppLoader />;
        if (!user) return <WelcomeScreen onSetupComplete={handleSetupComplete} />;

        const NavButton = ({ sectionName, icon, label, badgeCount }) => <button onClick={() => setActiveSection({name: sectionName})} className={`w-full flex items-center justify-between gap-3 p-3 rounded-lg font-semibold text-left nav-link ${activeSection.name === sectionName ? 'active' : ''}`}><div className="flex items-center gap-3"><i className={`${icon} w-5 text-center`}></i> {label}</div>{badgeCount > 0 && <span className="text-xs font-bold bg-teal-500 text-white h-5 w-5 rounded-full grid place-items-center">{badgeCount}</span>}</button>;
        const PremiumCard = () => <div className="p-4 rounded-lg text-center bg-gradient-to-br from-amber-400 to-orange-500 text-white shadow-lg"><i className="fas fa-crown text-3xl opacity-80"></i><h4 className="font-bold mt-2 font-display text-lg">Go Premium</h4><p className="text-xs text-white/80 mt-1 mb-3">Unlock expert notes & model questions.</p><button onClick={() => setShowPaymentModal(true)} className="bg-white text-amber-600 text-sm font-bold py-2 px-4 rounded-full w-full hover:scale-105 transition-transform animate-pulse">Upgrade Now</button></div>;

        return (
            <Fragment>
                {viewingNote && <PdfViewerModal note={viewingNote} onClose={() => setViewingNote(null)} />}
                {showPaymentModal && <PaymentModal onPaymentSuccess={handlePremiumUnlock} onClose={() => setShowPaymentModal(false)} userName={user.name} stream={user.stream} />}
                {showPresentationModal && <PresentationRequestModal user={user} onClose={() => setShowPresentationModal(false)} />}
                
                <div className="flex flex-col md:flex-row min-h-screen">
                    <aside className="w-full md:w-64 bg-white dark:bg-slate-900 p-4 flex-shrink-0 md:border-r border-slate-200 dark:border-slate-800 flex flex-col">
                        <div>
                            <div className="text-center md:text-left mb-6 flex items-center gap-3"><img src={DATA.logoUrl} alt="Logo" className="h-12 w-12 rounded-full" /><div><h2 className="text-xl font-bold font-display">{DATA.appName}</h2><p className="text-sm text-slate-500">({user.grade}) {user.name}</p></div></div>
                            <nav className="space-y-2">
                               <NavButton sectionName="dashboard" icon="fas fa-home-alt" label="Dashboard" />
                               <NavButton sectionName="explorer" icon="fas fa-compass" label="Note Explorer" />
                               <NavButton sectionName="studylist" icon="fas fa-bookmark" label="My Study List" badgeCount={bookmarkedNotes.length}/>
                               <NavButton sectionName="examprep" icon="fas fa-feather-alt" label="Exam Preps" />
                               <NavButton sectionName="tools" icon="fas fa-tools" label="Quick Tools" />
                               <NavButton sectionName="library" icon="fas fa-book-open" label="Digital Library" />
                               <NavButton sectionName="about"   icon="fas fa-info-circle" label="About" />

                               <button onClick={() => setShowPresentationModal(true)} className="w-full flex items-center gap-3 p-3 rounded-lg font-semibold text-left nav-link"><i className="fas fa-chalkboard-teacher w-5 text-center"></i> Request Presentation</button>
                            </nav>
                        </div>
                        <div className="mt-auto pt-6">
                            {!isPremium ? <PremiumCard /> : <div className="p-4 text-center"><p className="font-semibold text-amber-500 flex items-center justify-center gap-2"><i className="fas fa-check-circle"></i> Premium Member</p></div>}
                            <div className="mt-4 flex justify-center gap-6">
                                <a href={DATA.socials.youtube} target="_blank" className="text-slate-400 hover:text-red-500"><i className="fab fa-youtube text-xl"></i></a>
                                <a href={DATA.socials.facebook} target="_blank" className="text-slate-400 hover:text-blue-500"><i className="fab fa-facebook text-xl"></i></a>
                                <button onClick={handleLogout} className="text-slate-400 hover:text-red-500"><i className="fas fa-sign-out-alt text-xl"></i></button>
                            </div>
                        </div>
                    </aside>
                    <main className="flex-1 bg-slate-100 dark:bg-slate-950"><ErrorBoundary>{renderSection()}</ErrorBoundary></main>
                </div>
            </Fragment>
        );
    };

    ReactDOM.render(<App />, document.getElementById('root'));
</script>
</body>
</html>
